# ระบบจัดการข่าวสาร (News Management System)

คู่มือนี้อธิบายเกี่ยวกับระบบจัดการข่าวสารของ Playjoy LiveScore ที่มีความสามารถในการซิงค์ข่าวสารแบบอัตโนมัติทุก 12 ชั่วโมง พร้อมกับการแปลข่าวต่างประเทศเป็นภาษาไทย

## โครงสร้างระบบ

### 1. ฐานข้อมูล
- ตาราง `news_articles` เก็บข้อมูลข่าวทั้งข่าวไทยและข่าวต่างประเทศ
- มีการเก็บข้อมูลทั้งข้อความต้นฉบับ (ภาษาอังกฤษ) และข้อความที่แปลแล้ว (ภาษาไทย)
- ดูโครงสร้างตารางได้ที่ไฟล์ `db-init.sql`

### 2. API Endpoints
- `/api/news/sync` - API สำหรับการซิงค์ข่าวสารอัตโนมัติ ถูกเรียกโดย CRON job ทุก 12 ชั่วโมง (00:00 และ 12:00 น.)

### 3. Services
- `newsService.ts` - บริการจัดการข่าวสาร มีฟังก์ชันสำหรับการดึงข่าว บันทึกข่าว และซิงค์ข่าวสาร
- `translationService.ts` - บริการแปลภาษา ทำหน้าที่แปลข่าวต่างประเทศเป็นภาษาไทย

### 4. หน้าต่างผู้ใช้
- `/news` - หน้าแสดงข่าวสารสำหรับผู้ใช้ทั่วไป
- `/admin/news` - หน้าจัดการข่าวสารสำหรับผู้ดูแลระบบ

## การตั้งค่า CRON Job

ระบบใช้ CRON job ของ Vercel ในการซิงค์ข่าวสารอัตโนมัติทุก 12 ชั่วโมง โดยมีการตั้งค่าใน `vercel.json` ดังนี้:

```json
{
  "crons": [{
    "path": "/api/news/sync",
    "schedule": "0 0,12 * * *"
  }]
}
```

## การซิงค์ข่าวสาร

ระบบจะทำการซิงค์ข่าวสารในขั้นตอนดังนี้:

1. ดึงข่าวสารจากแหล่งข่าวต่างประเทศ (NewsAPI.org)
2. แปลข่าวต่างประเทศเป็นภาษาไทยโดยใช้ Translation API
3. ดึงข่าวสารจากแหล่งข่าวภายในประเทศไทย
4. บันทึกข่าวทั้งหมดลงในฐานข้อมูล Supabase

## การติดตั้งและการตั้งค่า

### ตัวแปรสภาพแวดล้อม

ตัวแปรสภาพแวดล้อมที่จำเป็นต้องกำหนดใน `.env.local`:

```
# Supabase
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key

# NewsAPI
NEWS_API_KEY=your-newsapi-key

# Translation API
TRANSLATION_API_KEY=your-translation-api-key

# CRON Security
CRON_SECRET_KEY=your-cron-secret-key
```

### การตั้งค่าฐานข้อมูล

1. สร้างโปรเจคใหม่ใน Supabase
2. รันสคริปต์ SQL ที่อยู่ในไฟล์ `db-init.sql` เพื่อสร้างตารางและข้อมูลเริ่มต้น

## การใช้งานสำหรับผู้ดูแลระบบ

ผู้ดูแลระบบสามารถจัดการข่าวสารได้ที่หน้า `/admin/news` โดยมีความสามารถดังนี้:

1. ดูรายการข่าวสารทั้งหมด
2. กรองข่าวตามประเภท (ข่าวไทย/ข่าวต่างประเทศ)
3. ซิงค์ข่าวสารใหม่ด้วยตนเอง
4. ดูเวลาที่ซิงค์ข่าวครั้งล่าสุด

## การแปลภาษา

ระบบใช้ Translation API ในการแปลข่าวต่างประเทศเป็นภาษาไทย โดยในโหมดพัฒนา (development) จะใช้การแปลแบบจำลองอย่างง่าย และในโหมดการใช้งานจริง (production) จะใช้ Google Translation API

## การแก้ไขปัญหา

### ข่าวไม่อัพเดตอัตโนมัติ
1. ตรวจสอบว่า CRON job ตั้งค่าถูกต้องใน Vercel
2. ตรวจสอบ logs ของ Vercel Functions ว่ามีข้อผิดพลาดหรือไม่
3. ตรวจสอบว่า API key ของ News API และ Translation API ถูกต้องและยังไม่หมดอายุ

### ข่าวต่างประเทศไม่ถูกแปลเป็นภาษาไทย
1. ตรวจสอบว่า Translation API key ถูกต้อง
2. ตรวจสอบว่าเชื่อมต่อกับ Translation API ได้
3. ตรวจสอบ logs ของ Translation API ว่ามีข้อผิดพลาดหรือไม่

## การพัฒนาเพิ่มเติม

ระบบนี้สามารถพัฒนาเพิ่มเติมได้ดังนี้:

1. เพิ่มระบบค้นหาข่าว
2. เพิ่มการจัดประเภทข่าวโดยใช้ AI
3. เพิ่มระบบแนะนำข่าวที่น่าสนใจสำหรับผู้ใช้
4. ปรับปรุงคุณภาพการแปลภาษาโดยใช้ AI ที่เฉพาะทางด้านกีฬา
