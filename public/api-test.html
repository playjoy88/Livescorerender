<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test Page</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        h1,
        h2,
        h3 {
            margin-top: 20px;
            color: #333;
        }
        
        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 15px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        button.blue {
            background-color: #008CBA;
        }
        
        button.red {
            background-color: #f44336;
        }
        
        button.orange {
            background-color: #ff9800;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .result {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            overflow: auto;
            max-height: 500px;
        }
        
        pre {
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
            display: none;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        .error {
            color: red;
            font-weight: bold;
            padding: 10px;
            background-color: #ffeeee;
            border: 1px solid #ffcccc;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .info {
            background-color: #e7f3fe;
            border-left: 6px solid #2196F3;
            padding: 10px;
            margin-bottom: 15px;
        }
        
        .endpoint-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .endpoint-input input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .endpoint-input button {
            height: 36px;
        }
        
        .environment-info {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .environment-info div {
            margin-bottom: 5px;
        }
        
        .environment-info strong {
            display: block;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>

<body>
    <h1>API-SPORTS Football API Test</h1>

    <div class="info">
        <p><strong>Note:</strong> This page uses the secure server-side proxy to make API requests. This keeps your API key secure.</p>
    </div>

    <div class="environment-info">
        <div>
            <strong>Environment:</strong>
            <span id="environment">Production</span>
        </div>
        <div>
            <strong>API Proxy Endpoint:</strong>
            <span id="apiUrl">/api/proxy</span>
        </div>
        <div>
            <strong>API Key Status:</strong>
            <span id="apiKeyStatus">Using server-side API key</span>
        </div>
        <div>
            <strong>Current Host:</strong>
            <span id="currentHost"></span>
        </div>
    </div>

    <h2>Pre-defined API Tests</h2>
    <div class="container">
        <button id="testStatus">Test Status API</button>
        <button id="testCountries" class="blue">Test Countries API</button>
        <button id="testLeagues" class="orange">Test Leagues API</button>
        <button id="testLive" class="red">Test Live Fixtures API</button>
    </div>

    <h2>Custom API Endpoint Test</h2>
    <div class="endpoint-input">
        <input type="text" id="customEndpoint" placeholder="Enter endpoint (e.g., 'leagues' or 'fixtures?live=all')">
        <button id="testCustom">Test Endpoint</button>
    </div>

    <div id="errorContainer" class="error" style="display: none;"></div>
    <div id="loader" class="loader"></div>
    <div id="result" class="result" style="display: none;">
        <h3>API Response</h3>
        <pre id="resultContent"></pre>
    </div>

    <script>
        // Configuration - using server-side proxy
        const API_URL = '/api/proxy';

        // Update environment info
        document.getElementById('currentHost').textContent = window.location.hostname || 'local';

        // Helper function to make API requests
        async function fetchAPI(endpoint) {
            document.getElementById('loader').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            document.getElementById('errorContainer').style.display = 'none';

            try {
                console.log('Making request to:', `${API_URL}?endpoint=${endpoint}`);

                const response = await fetch(`${API_URL}?endpoint=${endpoint}`);

                // Log rate limit info
                if (response.headers) {
                    console.log('Rate Limit Headers:');
                    console.log('Daily limit:', response.headers.get('x-ratelimit-requests-limit'));
                    console.log('Daily remaining:', response.headers.get('x-ratelimit-requests-remaining'));
                }

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                displayResult(data);
            } catch (error) {
                displayError(error.message);
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }

        // Display API result
        function displayResult(data) {
            const resultContainer = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');

            resultContent.textContent = JSON.stringify(data, null, 2);
            resultContainer.style.display = 'block';
        }

        // Display error message
        function displayError(message) {
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.textContent = `Error: ${message}`;
            errorContainer.style.display = 'block';
        }

        // Event listeners for the test buttons
        document.getElementById('testStatus').addEventListener('click', () => {
            fetchAPI('status');
        });

        document.getElementById('testCountries').addEventListener('click', () => {
            fetchAPI('countries');
        });

        document.getElementById('testLeagues').addEventListener('click', () => {
            fetchAPI('leagues');
        });

        document.getElementById('testLive').addEventListener('click', () => {
            fetchAPI('fixtures?live=all');
        });

        // Custom endpoint test
        document.getElementById('testCustom').addEventListener('click', () => {
            const endpoint = document.getElementById('customEndpoint').value.trim();
            if (endpoint) {
                fetchAPI(endpoint);
            } else {
                displayError('Please enter a valid endpoint');
            }
        });

        // Enable pressing Enter in the custom endpoint input
        document.getElementById('customEndpoint').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('testCustom').click();
            }
        });

        // Initial test to check API status
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('testStatus').click();
        });
    </script>
</body>

</html>